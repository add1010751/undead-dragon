<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ­»é¾éºè¨€ - é¸é …è®Šæ›æ¨¡æ“¬å™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    :root {
        --bg-color: #121218;
        --panel-bg: #1e1e26;
        --slot-bg: #2a2a35;
        --border-color: #333340;
        --primary-color: #00e5ff;
        --accent-color: #ffd700;
        --text-main: #e0e0e0;
        --text-sub: #a0a0b0;
        --max-stat-color: #4fc3f7;
        --min-stat-color: #757575;
    }

    * { box-sizing: border-box; }

    body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* å®¹å™¨ä½ˆå±€ */
    .container {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 20px;
        width: 100%;
        max-width: 900px;
    }

    /* å·¦å´ï¼šè£å‚™é¢æ¿ */
    .weapon-panel {
        background: var(--panel-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .panel-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }

    .item-image {
        width: 64px;
        height: 64px;
        border-radius: 8px;
        border: 2px solid var(--primary-color);
        background: #000;
        object-fit: cover;
        box-shadow: 0 0 10px rgba(0, 229, 255, 0.3);
    }

    .item-info h2 {
        margin: 0;
        font-size: 1.2rem;
        color: var(--primary-color);
    }

    .item-info span {
        font-size: 0.9rem;
        color: var(--text-sub);
    }

    /* å±¬æ€§æ§½ä½ */
    .slots-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex-grow: 1;
        margin-bottom: 20px; /* å¢åŠ åº•éƒ¨é–“è·çµ¦ç¸½åˆ† */
    }

    .option-slot {
        background: var(--slot-bg);
        padding: 12px 15px;
        border-radius: 6px;
        border: 1px solid transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.95rem;
        transition: all 0.2s;
        min-height: 50px;
    }
    
    .option-slot:hover {
        border-color: #555;
    }

    .option-name {
        flex: 1;
    }

    .score-tag {
        background: rgba(0, 229, 255, 0.15);
        color: var(--primary-color);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: bold;
        margin-left: 10px;
        white-space: nowrap;
    }

    /* å·¦å´é¢æ¿åº•éƒ¨çš„ç¸½åˆ†å€å¡Š */
    .panel-footer {
        border-top: 1px solid var(--border-color);
        padding-top: 15px;
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .total-score-label {
        font-size: 1rem;
        color: var(--text-sub);
        font-weight: bold;
    }

    .total-score-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-color);
        text-shadow: 0 0 10px rgba(0, 229, 255, 0.4);
        font-family: 'Consolas', monospace;
    }

    /* å³å´ï¼šæ§åˆ¶èˆ‡æ•¸æ“š */
    .control-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* æ•¸æ“šå„€è¡¨æ¿ */
    .stats-card {
        background: var(--panel-bg);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-color);
    }

    .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        font-size: 0.95rem;
    }

    .stat-row:last-child { margin-bottom: 0; }

    .stat-label { 
        color: var(--text-sub); 
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .stat-value { 
        font-weight: bold; 
        color: #fff;
        font-family: 'Consolas', monospace;
    }

    .stat-value.highlight { color: var(--accent-color); font-size: 1.1rem; }
    
    /* åŒ¯ç‡é¡¯ç¤ºæ¨£å¼ */
    .rate-info {
        font-size: 0.75rem;
        color: #666;
        font-weight: normal;
    }
    
    /* è¨­å®šå€ */
    .settings-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0,0,0,0.2);
        padding: 10px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 0.9rem;
    }

    .settings-row input {
        background: transparent;
        border: none;
        border-bottom: 1px solid var(--text-sub);
        color: var(--accent-color);
        width: 50px;
        text-align: right;
        font-size: 1rem;
        font-weight: bold;
    }
    .settings-row input:focus { outline: none; border-bottom-color: var(--accent-color); }

    /* æŒ‰éˆ•ç¾¤çµ„ */
    .buttons-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    button {
        border: none;
        padding: 15px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.1s, filter 0.2s;
        position: relative;
        overflow: hidden;
    }

    button:active { transform: scale(0.98); }

    .btn-roll {
        background: linear-gradient(135deg, var(--primary-color), #00b0ff);
        color: #000;
        box-shadow: 0 4px 15px rgba(0, 229, 255, 0.3);
    }

    .btn-search {
        background: var(--slot-bg);
        color: var(--text-main);
        border: 1px solid var(--border-color);
    }
    .btn-search:hover { background: #333340; color: #fff; }

    .btn-search-high {
        background: rgba(255, 61, 0, 0.1);
        color: #ff5722;
        border: 1px solid #ff5722;
    }
    .btn-search-high:hover { background: rgba(255, 61, 0, 0.2); }

    .btn-reset {
        background: transparent;
        color: var(--text-sub);
        border: 1px dashed var(--border-color);
        margin-top: 10px;
    }
    .btn-reset:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
        border-color: #666;
    }

    /* RWD */
    @media (max-width: 768px) {
        .container { grid-template-columns: 1fr; }
        .weapon-panel { min-height: auto; }
    }
</style>
</head>
<body>

<div class="container">
    <!-- å·¦å´ï¼šæ­¦å™¨é¢æ¿ -->
    <div class="weapon-panel">
        <div class="panel-header">
            <img src="https://i.ibb.co/mCMGCxPz/image.png" class="item-image" alt="è£å‚™åœ–ç‰‡">
            <div class="item-info">
                <h2>æ­»é¾éºè¨€</h2>
                <span>å±¬æ€§è®Šæ›´æ¨¡æ“¬</span>
            </div>
        </div>

        <div id="result" class="slots-container">
            <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
            <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
            <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
            <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
        </div>

        <!-- ç¸½è©•åˆ†ç§»è‡³æ­¤è™• -->
        <div class="panel-footer">
            <span class="total-score-label">è£å‚™ç¸½è©•åˆ†</span>
            <span id="total-score" class="total-score-value">0.0</span>
        </div>
    </div>

    <!-- å³å´ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        
        <!-- æ•¸æ“šçµ±è¨ˆ -->
        <div class="stats-card">
            <div class="stat-row">
                <span class="stat-label">è®Šæ›æ¬¡æ•¸</span>
                <span id="click-count" class="stat-value">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">æ¶ˆè€— ED</span>
                <span id="click2-count" class="stat-value highlight">0.0 å„„</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">å°å¹£ä¼°ç®—</span>
                <span class="stat-value highlight">NT$ <span id="ed-twd">0</span></span>
            </div>
            <!-- æ–°å¢æ¸¯å¹£ä¼°ç®— (å«åŒ¯ç‡) -->
            <div class="stat-row">
                <span class="stat-label">
                    æ¸¯å¹£ä¼°ç®—
                    <span id="rate-display" class="rate-info">
                        (è®€å–åŒ¯ç‡ä¸­...)
                    </span>
                </span>
                <span class="stat-value">HK$ <span id="ed-hkd">0</span></span>
            </div>

            <div class="settings-row">
                <span>å¹£å€¼åŒ¯ç‡ (100T)</span>
                <div>
                    <input id="ed-multiplier" type="number" step="0.1" value="5"> å„„
                </div>
            </div>
        </div>

        <!-- æŒ‰éˆ•å€ -->
        <div class="buttons-group">
            <button class="btn-roll" onclick="wrapAction(getRandomOptions)">
                ğŸ² å–®æ¬¡è®Šæ›
            </button>
            <button class="btn-search" onclick="wrapAction(findTargetOptions)">
                ğŸ” æœå°‹ 27åˆ†ä»¥ä¸Š
            </button>
            <button class="btn-search-high" onclick="wrapAction(findTargetOptions2)">
                âš¡ æœå°‹ 30åˆ†ä»¥ä¸Š (è€—æ™‚)
            </button>
            <button class="btn-reset" onclick="resetSimulation()">
                ğŸ”„ é‡ç½®æ¨¡æ“¬
            </button>
        </div>
    </div>
</div>

<script>
// --- åŒ¯ç‡é‚è¼¯é–‹å§‹ ---
let hkdToTwdRate = 4.1; // é è¨­å€¼ (è‹¥ API å¤±æ•—æ™‚ä½¿ç”¨)

async function fetchExchangeRate() {
    const rateDisplay = document.getElementById('rate-display');
    try {
        // ä½¿ç”¨å…¬é–‹å…è²» API ç²å– HKD åŸºç¤åŒ¯ç‡
        const response = await fetch('https://open.er-api.com/v6/latest/HKD');
        const data = await response.json();
        
        if (data && data.rates && data.rates.TWD) {
            hkdToTwdRate = data.rates.TWD;
            rateDisplay.textContent = `(1:${hkdToTwdRate.toFixed(2)})`;
            rateDisplay.style.color = '#a0a0b0'; // æ¢å¾©æ­£å¸¸é¡è‰²
            // è‹¥ç›®å‰å·²æœ‰æ•¸å€¼ï¼Œç«‹å³æ›´æ–° UI
            updateStatsUI(clickCount, parseFloat(document.getElementById('total-score').textContent));
        } else {
            throw new Error("åŒ¯ç‡è³‡æ–™æ ¼å¼éŒ¯èª¤");
        }
    } catch (error) {
        console.error("åŒ¯ç‡ç²å–å¤±æ•—:", error);
        rateDisplay.textContent = `(é è¨­ 1:${hkdToTwdRate})`;
        rateDisplay.style.color = '#d32f2f'; // ç´…è‰²æç¤ºéŒ¯èª¤
    }
}

// é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
window.onload = function() {
    fetchExchangeRate();
};

// --- åŸæœ‰é‚è¼¯ ---
let clickCount = 0;
let searchCount = 0;

// å±¬æ€§èˆ‡æ©Ÿç‡è¨­å®š
const options = [
    ["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 0.8, 1.5, true, 0.8],
    ["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 0.8, 1.5, true, 0.8],
    ["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 0.8, 1.5, true, 0.8],
    ["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 0.8, 1.5, true, 0.8],
    ["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•é˜²ç¦¦åŠ›", 0.8, 1.5, true, 0.8],
    ["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 5, 12, false, 6.4],
    ["ç„¡è¦–æ•µäººç‰©ç†/é­”æ³•é˜²ç¦¦åŠ›", 4.5, 8, false, 6.4],
    ["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 6, 13, false, 6.4],
    ["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 5, 12, false, 6.4],
    ["è‡´å‘½ä¸€æ“Šå‚·å®³", 6, 13, false, 6.4],
    ["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 6, 13, false, 6.4],
    ["ç‰©ç†/é­”æ³•é˜²ç¦¦åŠ›", 6, 13, false, 6.4],
    ["å‚·å®³æ¸›å°‘", 8, 15, false, 6.4],
    ["çµ¦äºˆBosså‚·å®³å¢åŠ ", 8, 15, false, 6.4],
    ["æ‰€å—Bosså‚·å®³æ¸›å°‘", 8, 15, false, 6.4],
    ["å¼·éŸŒæŠ€èƒ½å‚·å®³å¢åŠ ", 6, 13, false, 6.4],
    ["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 6, 13, false, 6.4],
    ["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 6, 13, false, 6.4],
    ["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 6, 13, false, 6.4],
    ["å‹•ä½œé€Ÿåº¦", 8, 15, false, 6.4]
];

// è©•åˆ†è¡¨
const scoreTable = [
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 0.8, 5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 0.9, 6],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.0, 6.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.1, 7],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.2, 7.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.3, 8],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.4, 9],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 1.5, 9.5],

["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 0.8, 4.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 0.9, 5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.0, 5.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.1, 6.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.2, 7],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.3, 7.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.4, 8],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œæ‰€æœ‰æŠ€èƒ½å‚·å®³", 1.5, 8.5],

["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 0.8, 4],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 0.9, 4.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.0, 5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.1, 5.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.2, 6],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.3, 6.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.4, 7],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 1.5, 7.5],

["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 0.8, 4],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 0.9, 4.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.0, 5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.1, 5.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.2, 6],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.3, 6.5],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.4, 7],
["æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œè‡´å‘½ä¸€æ“Šå‚·å®³", 1.5, 7.5],

["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 6, 3],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 7, 3.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 8, 4],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 9, 4.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 10, 5.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 11, 6],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 12, 6.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›", 13, 7],

["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 8, 4],
["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 9, 4.5],
["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 10, 4.5],
["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 11, 5],
["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 12, 6],
["æ‰€æœ‰æŠ€èƒ½å‚·å®³å¢åŠ ", 13, 6.5],

["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 6, 2],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 7, 2.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 8, 3],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 9, 3.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 10, 4],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 11, 4.5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 12, 5],
["ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š", 13, 5.5],

["è‡´å‘½ä¸€æ“Šå‚·å®³", 6, 2.5],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 7, 3],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 8, 3.5],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 9, 3.5],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 10, 4],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 11, 4.5],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 12, 5],
["è‡´å‘½ä¸€æ“Šå‚·å®³", 13, 5.5],

["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 6, 4],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 7, 4.5],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 8, 5],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 9, 6],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 10, 6.5],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 11, 7],
["å…©æ¥µåŒ–ï¼šæ”»æ“Š/è¢«æ“Šå‚·å®³", 12, 8],

["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 6, 4],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 7, 4.5],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 8, 5],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 9, 6],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 10, 6.5],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 11, 7],
["æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³", 12, 8],

["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 8, 3],
["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 9, 3.5],
["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 10, 4],
["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 11, 4.5],
["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 12, 5],
["å¼·çƒˆæŠ€èƒ½å‚·å®³å¢åŠ ", 13, 5.5],

["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 8, 3],
["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 9, 3.5],
["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 10, 4],
["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 11, 4.5],
["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 12, 5],
["è¶…è¶ŠæŠ€èƒ½å‚·å®³å¢åŠ ", 13, 5.5],

["çµ¦äºˆBosså‚·å®³å¢åŠ ", 8, 2.5],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 9, 3],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 10, 3.5],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 11, 4],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 12, 4],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 13, 4.5],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 14, 4.5],
["çµ¦äºˆBosså‚·å®³å¢åŠ ", 15, 5],
];

// --- ä»‹é¢æ›´æ–°å‡½å¼ ---

function wrapAction(action) {
    setTimeout(() => {
        action();
    }, 10);
}

function updateStatsUI(count, score) {
    document.getElementById('click-count').textContent = count;
    document.getElementById('total-score').textContent = score.toFixed(1);
    
    // ED è¨ˆç®—
    const edCost = (count * 0.2);
    document.getElementById('click2-count').textContent = edCost.toFixed(1) + " å„„";
    
    // å°å¹£è¨ˆç®—
    const multiplier = parseFloat(document.getElementById('ed-multiplier').value) || 5;
    const twd = (edCost / multiplier * 100); 
    document.getElementById('ed-twd').textContent = Math.round(twd).toLocaleString();

    // æ¸¯å¹£è¨ˆç®— (ä½¿ç”¨ API ç²å–çš„åŒ¯ç‡)
    const hkd = twd / hkdToTwdRate;
    document.getElementById('ed-hkd').textContent = Math.round(hkd).toLocaleString();
}

function weightedRandom(excluded = []) {
    let available = options.filter((_, i) => !excluded.includes(i));
    let totalWeight = available.reduce((sum, o) => sum + o[4], 0);
    let r = Math.random() * totalWeight;
    let cumulative = 0;
    for (let i = 0; i < available.length; i++) {
        cumulative += available[i][4];
        if (r <= cumulative) return options.indexOf(available[i]);
    }
    return options.indexOf(available[available.length - 1]);
}

function getScore(name, value) {
    let candidates = scoreTable.filter(s => s[0] === name);
    if (candidates.length === 0) return 0;
    let closest = candidates.reduce((prev, curr) => {
        return Math.abs(curr[1] - value) < Math.abs(prev[1] - value) ? curr : prev;
    });
    return closest[2];
}

function formatOptionDisplay(name, value) {
    if (name === "æ­¦å™¨å¼·åŒ–æ•¸å€¼æ¯1ï¼Œç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š") return `${name}+${value} Lv`;
    if (name === "ç‰©ç†/é­”æ³•æ”»æ“ŠåŠ›ç­‰ç´š") return `${name}+${value} Lv`;
    if (name === "æ ¹æ“šæ”»æ“Šæ™‚çµ¦äºˆçš„å‚·å®³é‡çš„n%ï¼Œåœ¨3ç§’å…§çµ¦äºˆæŒçºŒå‚·å®³") return `${name.replace("n%", value + "%")}`;
    return `${name} : ${value}%`;
}

// æ ¸å¿ƒé‚è¼¯ - å–®æ¬¡è®Šæ›
function getRandomOptions() {
    let selected = [];
    let resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';
    let totalScore = 0;

    while (selected.length < 4) {
        let randomIndex = weightedRandom(selected);
        selected.push(randomIndex);
    }

    selected.forEach(index => {
        let opt = options[index];
        let val = Math.random() * (opt[2] - opt[1]) + opt[1];
        val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);
        let score = getScore(opt[0], val);
        totalScore += score;
        
        let div = document.createElement('div');
        div.className = "option-slot";
        
        let colorStyle = "";
        if (val === opt[1]) colorStyle = "color: var(--min-stat-color);";
        else if (val === opt[2]) colorStyle = "color: var(--max-stat-color); text-shadow: 0 0 5px rgba(79, 195, 247, 0.5);";
        
        div.innerHTML = `
            <span class="option-name" style="${colorStyle}">${formatOptionDisplay(opt[0], val)}</span>
            <span class="score-tag">${score} åˆ†</span>
        `;
        resultDiv.appendChild(div);
    });

    clickCount++;
    updateStatsUI(clickCount, totalScore);
}

// æ ¸å¿ƒé‚è¼¯ - æœå°‹
function findTargetOptions() {
    clickCount = 0;
    let localSearchCount = 0;
    
    while (true) {
        localSearchCount++;
        let selected = [];
        
        while (selected.length < 4) selected.push(weightedRandom(selected));

        let totalScore = 0;
        let tempHTML = "";

        selected.forEach(index => {
            let opt = options[index];
            let val = Math.random() * (opt[2] - opt[1]) + opt[1];
            val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);
            let score = getScore(opt[0], val);
            totalScore += score;

            let colorStyle = "";
            if (val === opt[1]) colorStyle = "color: var(--min-stat-color);";
            else if (val === opt[2]) colorStyle = "color: var(--max-stat-color); text-shadow: 0 0 5px rgba(79, 195, 247, 0.5);";

            tempHTML += `
                <div class="option-slot">
                    <span class="option-name" style="${colorStyle}">${formatOptionDisplay(opt[0], val)}</span>
                    <span class="score-tag">${score} åˆ†</span>
                </div>`;
        });

        if (totalScore >= 27) {
            document.getElementById('result').innerHTML = tempHTML;
            clickCount += localSearchCount;
            updateStatsUI(clickCount, totalScore);
            break;
        }

        if (localSearchCount > 10000000) {
            alert("æ¨¡æ“¬è¶…é 1,000 è¬æ¬¡ä»æœªé”æˆæ¢ä»¶ã€‚");
            clickCount += localSearchCount;
            updateStatsUI(clickCount, 0);
            break;
        }
    }
}

function findTargetOptions2() {
    clickCount = 0;
    let localSearchCount = 0;
    
    while (true) {
        localSearchCount++;
        let selected = [];
        while (selected.length < 4) selected.push(weightedRandom(selected));

        let totalScore = 0;
        let tempHTML = "";

        selected.forEach(index => {
            let opt = options[index];
            let val = Math.random() * (opt[2] - opt[1]) + opt[1];
            val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);
            let score = getScore(opt[0], val);
            totalScore += score;

            let colorStyle = "";
            if (val === opt[1]) colorStyle = "color: var(--min-stat-color);";
            else if (val === opt[2]) colorStyle = "color: var(--max-stat-color); text-shadow: 0 0 5px rgba(79, 195, 247, 0.5);";

            tempHTML += `
                <div class="option-slot">
                    <span class="option-name" style="${colorStyle}">${formatOptionDisplay(opt[0], val)}</span>
                    <span class="score-tag">${score} åˆ†</span>
                </div>`;
        });

        if (totalScore >= 30) {
            document.getElementById('result').innerHTML = tempHTML;
            clickCount += localSearchCount;
            updateStatsUI(clickCount, totalScore);
            break;
        }

        if (localSearchCount > 10000000) {
            alert("æ¨¡æ“¬è¶…é 1,000 è¬æ¬¡ä»æœªé”æˆæ¢ä»¶ã€‚");
            clickCount += localSearchCount;
            updateStatsUI(clickCount, 0);
            break;
        }
    }
}

function resetSimulation() {
    clickCount = 0;
    updateStatsUI(0, 0);
    
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `
        <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
        <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
        <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
        <div class="option-slot"><span style="color:var(--text-sub)">å°šæœªé‘‘å®š</span></div>
    `;
}
</script>
</body>
</html>