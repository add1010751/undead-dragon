<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>選項變換模擬器</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #1e1e1e;
        color: white;
        text-align: center;
    }
    .item-box {
        width: 500px; /* 加寬 */
        margin: 50px auto;
        background: #222;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        text-align: left;
    }
    .item-header {
        background: black;
        color: cyan;
        font-weight: bold;
        padding: 10px;
        border-radius: 10px 10px 0 0;
        text-align: center;
    }
    .item-image {
        width: 60px;
        height: 60px;
        margin: 10px auto;
        display: block;
        border-radius: 8px;
        border: 2px solid #ccc;
    }
    .option-slot {
        background: white;
        color: black;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        white-space: nowrap;
    }
    .score-tag {
        background-color: #0078d7;
        color: #fff;
        border-radius: 6px;
        padding: 0 5px;
        flex-shrink: 0;
        margin-left: 10px;
    }
    .button {
        background: cyan;
        color: black;
        font-weight: bold;
        padding: 10px;
        border: none;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 5px;
        width: 100%;
    }
    .button:hover {
        background: lightblue;
    }
    .count-display, .search-count, .ed-display {
        margin-top: 10px;
        font-weight: bold;
    }
    .count-display { color: yellow; }
    .search-count { color: lightblue; }
    .ed-display { color: lightblue; font-size: 1.2em; }
	
	
</style>
</head>
<body>
<div class="item-box">
    <div class="item-header">死龍遺言 - 模擬武器</div>
    <img src="https://i.ibb.co/mCMGCxPz/image.png" class="item-image" alt="裝備圖片">
    <div id="result">
        <div class="option-slot">尚未套用任何屬性。</div>
        <div class="option-slot">尚未套用任何屬性。</div>
        <div class="option-slot">尚未套用任何屬性。</div>
        <div class="option-slot">尚未套用任何屬性。</div>
    </div>
    <button class="button" onclick="getRandomOptions()">選項變換</button>
    <button class="button" onclick="findTargetOptions()">搜尋27分以上屬性</button>
	<button class="button" onclick="findTargetOptions2()">搜尋30分以上屬性(會卡)</button>
    <div id="count-score" style="display:flex; justify-content: space-between; font-weight:bold; margin-top:10px; color:yellow;">
    <span id="click-count">變換次數：0次</span>
    <span id="total-score">總分：0 分</span>
</div>
<div style="margin-top:5px; display:flex; justify-content: space-between; align-items:center;">
    <span id="click2-count">花費ＥＤ：0</span>
    <span>
        100台幣 = 
    </span>
</div>
<div style="margin-top:5px; font-weight:bold; color:lightgreen; display:flex; justify-content: space-between; align-items:center;">
    <span>花費台幣：<span id="ed-twd">0</span></span>
    <div style="display:flex; align-items:center;">
        <input id="ed-multiplier" type="number" step="0.01" value="5" style="width:40px; text-align:right;">
        <span style="margin-left:5px;">億ED</span>
    </div>

</div>






<script>
let clickCount = 0;
let searchCount = 0;

// 屬性與機率設定
const options = [
    ["武器強化數值每1，物理/魔法攻擊力", 0.8, 1.5, true, 0.8],
    ["武器強化數值每1，物理/魔法攻擊力等級", 0.8, 1.5, true, 0.8],
    ["武器強化數值每1，致命一擊傷害", 0.8, 1.5, true, 0.8],
    ["武器強化數值每1，所有技能傷害", 0.8, 1.5, true, 0.8],
    ["武器強化數值每1，物理/魔法防禦力", 0.8, 1.5, true, 0.8],
    ["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 5, 12, false, 6.4],
    ["無視敵人物理/魔法防禦力", 4.5, 8, false, 6.4],
    ["物理/魔法攻擊力", 6, 13, false, 6.4],
    ["兩極化：攻擊/被擊傷害", 5, 12, false, 6.4],
    ["致命一擊傷害", 6, 13, false, 6.4],
    ["物理/魔法攻擊力等級", 6, 13, false, 6.4],
    ["物理/魔法防禦力", 6, 13, false, 6.4],
    ["傷害減少", 8, 15, false, 6.4],
    ["給予Boss傷害增加", 8, 15, false, 6.4],
    ["所受Boss傷害減少", 8, 15, false, 6.4],
    ["強韌技能傷害增加", 6, 13, false, 6.4],
    ["強烈技能傷害增加", 6, 13, false, 6.4],
    ["超越技能傷害增加", 6, 13, false, 6.4],
    ["所有技能傷害增加", 6, 13, false, 6.4],
    ["動作速度", 8, 15, false, 6.4]
];

// 評分表
const scoreTable = [
["武器強化數值每1，物理/魔法攻擊力", 0.8, 5],
["武器強化數值每1，物理/魔法攻擊力", 0.9, 6],
["武器強化數值每1，物理/魔法攻擊力", 1.0, 6.5],
["武器強化數值每1，物理/魔法攻擊力", 1.1, 7],
["武器強化數值每1，物理/魔法攻擊力", 1.2, 7.5],
["武器強化數值每1，物理/魔法攻擊力", 1.3, 8],
["武器強化數值每1，物理/魔法攻擊力", 1.4, 9],
["武器強化數值每1，物理/魔法攻擊力", 1.5, 9.5],

["武器強化數值每1，所有技能傷害", 0.8, 4.5],
["武器強化數值每1，所有技能傷害", 0.9, 5],
["武器強化數值每1，所有技能傷害", 1.0, 5.5],
["武器強化數值每1，所有技能傷害", 1.1, 6.5],
["武器強化數值每1，所有技能傷害", 1.2, 7],
["武器強化數值每1，所有技能傷害", 1.3, 7.5],
["武器強化數值每1，所有技能傷害", 1.4, 8],
["武器強化數值每1，所有技能傷害", 1.5, 8.5],

["武器強化數值每1，物理/魔法攻擊力等級", 0.8, 4],
["武器強化數值每1，物理/魔法攻擊力等級", 0.9, 4.5],
["武器強化數值每1，物理/魔法攻擊力等級", 1.0, 5],
["武器強化數值每1，物理/魔法攻擊力等級", 1.1, 5.5],
["武器強化數值每1，物理/魔法攻擊力等級", 1.2, 6],
["武器強化數值每1，物理/魔法攻擊力等級", 1.3, 6.5],
["武器強化數值每1，物理/魔法攻擊力等級", 1.4, 7],
["武器強化數值每1，物理/魔法攻擊力等級", 1.5, 7.5],

["武器強化數值每1，致命一擊傷害", 0.8, 4],
["武器強化數值每1，致命一擊傷害", 0.9, 4.5],
["武器強化數值每1，致命一擊傷害", 1.0, 5],
["武器強化數值每1，致命一擊傷害", 1.1, 5.5],
["武器強化數值每1，致命一擊傷害", 1.2, 6],
["武器強化數值每1，致命一擊傷害", 1.3, 6.5],
["武器強化數值每1，致命一擊傷害", 1.4, 7],
["武器強化數值每1，致命一擊傷害", 1.5, 7.5],

["物理/魔法攻擊力", 6, 3],
["物理/魔法攻擊力", 7, 3.5],
["物理/魔法攻擊力", 8, 4],
["物理/魔法攻擊力", 9, 4.5],
["物理/魔法攻擊力", 10, 5.5],
["物理/魔法攻擊力", 11, 6],
["物理/魔法攻擊力", 12, 6.5],
["物理/魔法攻擊力", 13, 7],

["所有技能傷害增加", 8, 4],
["所有技能傷害增加", 9, 4.5],
["所有技能傷害增加", 10, 4.5],
["所有技能傷害增加", 11, 5],
["所有技能傷害增加", 12, 6],
["所有技能傷害增加", 13, 6.5],

["物理/魔法攻擊力等級", 6, 2],
["物理/魔法攻擊力等級", 7, 2.5],
["物理/魔法攻擊力等級", 8, 3],
["物理/魔法攻擊力等級", 9, 3.5],
["物理/魔法攻擊力等級", 10, 4],
["物理/魔法攻擊力等級", 11, 4.5],
["物理/魔法攻擊力等級", 12, 5],
["物理/魔法攻擊力等級", 13, 5.5],

["致命一擊傷害", 6, 2.5],
["致命一擊傷害", 7, 3],
["致命一擊傷害", 8, 3.5],
["致命一擊傷害", 9, 3.5],
["致命一擊傷害", 10, 4],
["致命一擊傷害", 11, 4.5],
["致命一擊傷害", 12, 5],
["致命一擊傷害", 13, 5.5],

["兩極化：攻擊/被擊傷害", 6, 4],
["兩極化：攻擊/被擊傷害", 7, 4.5],
["兩極化：攻擊/被擊傷害", 8, 5],
["兩極化：攻擊/被擊傷害", 9, 6],
["兩極化：攻擊/被擊傷害", 10, 6.5],
["兩極化：攻擊/被擊傷害", 11, 7],
["兩極化：攻擊/被擊傷害", 12, 8],

["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 6, 4],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 7, 4.5],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 8, 5],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 9, 6],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 10, 6.5],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 11, 7],
["根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害", 12, 8],


["強烈技能傷害增加", 8, 3],
["強烈技能傷害增加", 9, 3.5],
["強烈技能傷害增加", 10, 4],
["強烈技能傷害增加", 11, 4.5],
["強烈技能傷害增加", 12, 5],
["強烈技能傷害增加", 13, 5.5],

["超越技能傷害增加", 8, 3],
["超越技能傷害增加", 9, 3.5],
["超越技能傷害增加", 10, 4],
["超越技能傷害增加", 11, 4.5],
["超越技能傷害增加", 12, 5],
["超越技能傷害增加", 13, 5.5],

["給予Boss傷害增加", 8, 2.5],
["給予Boss傷害增加", 9, 3],
["給予Boss傷害增加", 10, 3.5],
["給予Boss傷害增加", 11, 4],
["給予Boss傷害增加", 12, 4],
["給予Boss傷害增加", 13, 4.5],
["給予Boss傷害增加", 14, 4.5],
["給予Boss傷害增加", 15, 5],

];

function updateEDTWD(ed) {
    const multiplier = parseFloat(document.getElementById('ed-multiplier').value) || 5;
    const twd = (ed / multiplier * 100).toFixed(0);
    document.getElementById('ed-twd').textContent = twd;
}

function weightedRandom(excluded = []) {
    let available = options.filter((_, i) => !excluded.includes(i));
    let totalWeight = available.reduce((sum, o) => sum + o[4], 0);
    let r = Math.random() * totalWeight;
    let cumulative = 0;
    for (let i = 0; i < available.length; i++) {
        cumulative += available[i][4];
        if (r <= cumulative) return options.indexOf(available[i]);
    }
    return options.indexOf(available[available.length - 1]);
}

function getScore(name, value) {
    // 選出同名選項，找最接近 value 的分數
    let candidates = scoreTable.filter(s => s[0] === name);
    if (candidates.length === 0) return 0;

    let closest = candidates.reduce((prev, curr) => {
        return Math.abs(curr[1] - value) < Math.abs(prev[1] - value) ? curr : prev;
    });

    return closest[2];
}


function formatOptionDisplay(name, value) {
    if (name === "武器強化數值每1，物理/魔法攻擊力等級") return `${name}+${value} Lv`;
    if (name === "物理/魔法攻擊力等級") return `${name}+${value} Lv`;
    if (name === "根據攻擊時給予的傷害量的n%，在3秒內給予持續傷害") return `${name.replace("n%", value + "%")}`;
    return `${name} : ${value}%`;
}

// 隨機抽選選項
function getRandomOptions() {
    let selected = [];
    let resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';

    let totalScore = 0;

    while (selected.length < 4) {
        let randomIndex = weightedRandom(selected);
        selected.push(randomIndex);
    }

    selected.forEach(index => {
        let opt = options[index];
        let val = Math.random() * (opt[2] - opt[1]) + opt[1];
        val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);

        let score = getScore(opt[0], val);
        totalScore += score;

        let div = document.createElement('div');
        div.className = "option-slot";
        if (val === opt[1]) div.style.color = "#A9A9A9";
        else if (val === opt[2]) div.style.color = "blue";

        div.innerHTML = `
            <span>${formatOptionDisplay(opt[0], val)}</span>
            <span class="score-tag">${score} 分</span>
        `;
        resultDiv.appendChild(div);
    });

    clickCount++;
	document.getElementById('click-count').textContent = `變換次數：${clickCount}次`;
	document.getElementById('total-score').textContent = `總分：${totalScore} 分`;
	document.getElementById('click2-count').textContent = `花費ＥＤ：${(clickCount*0.2).toFixed(1)} 億`;
	updateEDTWD(clickCount*0.2);
}

// 搜尋頂級屬性
function findTargetOptions() {
    searchCount = 0;
    while (true) {
        searchCount++;
        let selected = [];
        while (selected.length < 4) selected.push(weightedRandom(selected));

        let totalScore = 0;
        let resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';

        selected.forEach(index => {
            let opt = options[index];
            let val = Math.random() * (opt[2] - opt[1]) + opt[1];
            val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);
            let score = getScore(opt[0], val);
            totalScore += score;

            let div = document.createElement('div');
            div.className = "option-slot";
            if (val === opt[1]) div.style.color = "#A9A9A9";
            else if (val === opt[2]) div.style.color = "blue";
            div.innerHTML = `<span>${formatOptionDisplay(opt[0], val)}</span>
                             <span class="score-tag">${score} 分</span>`;
            resultDiv.appendChild(div);
        });

        // 條件修改為總分 >= 30
        if (totalScore >= 27) {
			document.getElementById('click-count').textContent = `變換次數：${searchCount}次`;
			document.getElementById('total-score').textContent = `總分：${totalScore} 分`;
			document.getElementById('click2-count').textContent = `花費ＥＤ：${(searchCount*0.2).toFixed(1)} 億`;
			updateEDTWD(searchCount*0.2);
			break;
		}


        if (searchCount > 10000000) {
            alert("模擬超過 1,000 萬次仍未達成條件，請檢查機率設定。");
            break;
        }
    }
}

function findTargetOptions2() {
    searchCount = 0;
    while (true) {
        searchCount++;
        let selected = [];
        while (selected.length < 4) selected.push(weightedRandom(selected));

        let totalScore = 0;
        let resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';

        selected.forEach(index => {
            let opt = options[index];
            let val = Math.random() * (opt[2] - opt[1]) + opt[1];
            val = opt[3] ? parseFloat(val.toFixed(1)) : Math.round(val);
            let score = getScore(opt[0], val);
            totalScore += score;

            let div = document.createElement('div');
            div.className = "option-slot";
            if (val === opt[1]) div.style.color = "#A9A9A9";
            else if (val === opt[2]) div.style.color = "blue";
            div.innerHTML = `<span>${formatOptionDisplay(opt[0], val)}</span>
                             <span class="score-tag">${score} 分</span>`;
            resultDiv.appendChild(div);
        });

        // 條件修改為總分 >= 30
        if (totalScore >= 30) {
			document.getElementById('click-count').textContent = `變換次數：${searchCount}次`;
			document.getElementById('total-score').textContent = `總分：${totalScore} 分`;
			document.getElementById('click2-count').textContent = `花費ＥＤ：${(searchCount*0.2).toFixed(1)} 億`;
			updateEDTWD(searchCount*0.2);
			break;
		}


        if (searchCount > 10000000) {
            alert("模擬超過 1,000 萬次仍未達成條件，請檢查機率設定。");
            break;
        }
    }
}

</script>
</body>
</html>
